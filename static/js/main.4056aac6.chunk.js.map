{"version":3,"sources":["BubbleChart.js","App.js","index.js"],"names":["BubbleChart","props","createBubbleChart","bind","emphasisObjects","Set","timeRange","add","this","_self","node","width","height","margin","x","d3","y","radius","color","d","has","svg","timeSlider","update","dataset","year","selectAll","data","dataAt","name","sort","a","b","population","transition","duration","attr","income","lifeExpectancy","map","region","valueAt","values","i","left","length","t","data_load","then","append","join","call","circle","text","on","currentTime","value","setInterval","Number","xAxis","g","ticks","select","remove","yAxis","renderAxes","id","type","min","max","step","defaultvalue","ref","Component","App","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.4056aac6.chunk.js","sourcesContent":["import React, { Component } from 'react'\nimport * as d3 from 'd3';\n\nclass BubbleChart extends Component {\n    constructor(props) {\n        super(props);\n        this.createBubbleChart = this.createBubbleChart.bind(this);\n        this.emphasisObjects = new Set();\n        this.timeRange = [1800, 2009];\n        this.emphasisObjects.add(\"United States\");\n    }\n\n    componentDidMount() {\n        this.createBubbleChart()\n    }\n    componentDidUpdate() {\n        this.createBubbleChart()\n    }\n\n    createBubbleChart() {\n        const _self = this;\n        const node = this.node\n        let width = 1000,\n            height = 500,\n            margin = ({top: 20, right: 20, bottom: 35, left: 40}),\n            interval = 100; \n        var x = d3.scaleLog([200, 1e5], [margin.left, width - margin.right]), \n            y = d3.scaleLinear([14, 86], [height - margin.bottom, margin.top]),\n            radius = d3.scaleSqrt([0, 5e8], [0, width / 24]),\n            color = d => _self.emphasisObjects.has(d)?\"red\":\"black\";\n\n        let svg = d3.select(node);\n        let timeSlider = d3.select('#timeSlider');\n\n        svg.attr(\"height\", height)\n            .attr(\"width\", width);\n\n        _self.props.data_load.then(function (dataset) {\n            // 図の初期化\n            timeSlider.attr('min', _self.timeRange[0]).attr('max', _self.timeRange[1]).attr('value', _self.timeRange[0])\n            svg.append(\"g\").attr(\"stroke\", \"black\")\n                           .selectAll(\"circle\")\n                           .data(dataAt(dataset, _self.timeRange[0]), d => d.name)\n                           .join(\"circle\")\n                           .sort((a, b) => d3.descending(a.population, b.population))\n                           .attr(\"cx\", d => x(d.income))\n                           .attr(\"cy\", d => y(d.lifeExpectancy))\n                           .attr(\"r\", d => radius(d.population))\n                           .attr(\"fill\", d => color(d.name))\n                           .call(circle => circle.append(\"title\")\n                           .text(d => [d.name, d.region].join(\"\\n\")));\n\n            timeSlider.on(\"change\", function() {\n                var currentTime = this.value;\n                update(dataset, currentTime)\n            });\n            function step(){\n                var currentTime = Number(timeSlider.attr('value'));\n                if (currentTime >= _self.timeRange[1] || currentTime < _self.timeRange[0]){\n                    timeSlider.attr(\"value\", _self.timeRange[0]);\n                    update(dataset, _self.timeRange[0]);\n                } else{\n                    timeSlider.attr(\"value\", currentTime+1);\n                    update(dataset, currentTime+1)\n                }\n            }\n            setInterval(step, interval)\n            renderAxes(svg)\n        });\n\n\n        function update(dataset, year){\n            const circles = svg.selectAll('circle')\n            circles.data(dataAt(dataset, year), d => d.name)\n                    .sort((a, b) => d3.descending(a.population, b.population))\n                    .transition().duration(interval)\n                    .attr(\"cx\", d => x(d.income))\n                    .attr(\"cy\", d => y(d.lifeExpectancy))\n                    .attr(\"r\", d => radius(d.population))\n                    .attr(\"fill\", d => color(d.name))\n        }\n\n        function dataAt(dataset, year) {\n            return dataset.map(d => ({\n              name: d.name,\n              region: d.region,\n              income: valueAt(d.income, year),\n              population: valueAt(d.population, year),\n              lifeExpectancy: valueAt(d.lifeExpectancy, year)\n            }))\n        }\n\n        function valueAt(values, year) {\n            const i = d3.bisector(([year]) => year).left(values, year, 0, values.length - 1);\n            const a = values[i];\n            if (year>a[0] || i===0){\n                return  a[1];\n                  \n            } else {\n              const b = values[i - 1];\n              const t = (year - a[0]) / (b[0] - a[0]);\n              return a[1] * (1 - t) + b[1] * t;\n            }\n          }\n\n        function renderAxes(svg) {\n            var xAxis = g => g.attr(\"transform\", `translate(0,${height - margin.bottom})`)\n                              .call(d3.axisBottom(x).ticks(width / 80, \",\"))\n                              .call(g => g.select(\".domain\").remove())\n                              .call(g => g.append(\"text\")\n                                  .attr(\"x\", width)\n                                  .attr(\"y\", margin.bottom - 4)\n                                  .attr(\"fill\", \"currentColor\")\n                                  .attr(\"text-anchor\", \"end\")\n                                  .text(\"Income per capita (dollars) →\"));\n\n            var yAxis = g => g.attr(\"transform\", `translate(${margin.left},0)`)\n                              .call(d3.axisLeft(y))\n                              .call(g => g.select(\".domain\").remove())\n                              .call(g => g.append(\"text\")\n                                  .attr(\"x\", -margin.left)\n                                  .attr(\"y\", 10)\n                                  .attr(\"fill\", \"currentColor\")\n                                  .attr(\"text-anchor\", \"start\")\n                                  .text(\"↑ Life expectancy (years)\"))\n\n            svg.append(\"g\")\n                .attr(\"class\", \"axis\")\n                .call(xAxis);\n\n            svg.append(\"g\")\n                .attr(\"class\", \"axis\")\n                .call(yAxis);\n        }\n\n    }\n\n    render() {\n        return <div>\n        <div>\n            <input id=\"timeSlider\" type=\"range\" min=\"1\" max=\"20\" step=\"1\" defaultvalue=\"10\"/>\n        </div>\n        <div>\n            <svg ref={node => this.node = node}/>\n        </div>\n        </div>\n    }\n}\n\nexport default BubbleChart\n","import './App.css';\nimport React, { Component } from 'react'\nimport BubbleChart from './BubbleChart'\nimport * as d3 from 'd3';\n\n\nclass App extends Component {\n  constructor(props) {\n    super(props)\n  }\n  render() {\n    const data_load = d3.json(\"./nations.json\") // d3.json\n    return (\n      <div>\n        <h2>React D3.js Bubble chart</h2>\n        <BubbleChart data_load={data_load} />\n      </div>\n    )\n  }\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n"],"sourceRoot":""}